<h1 id="目的">目的</h1>

<p>これまで、TX120s7やThinkpad x220/x230をkittingするためのISOイメージを作成するための作業スペースを公開用に再編集しました。
元々はpreseedを利用していましたが、Ubuntu 20.04以降のAutoInstallのみに対応しています。</p>

<h1 id="参考資料">参考資料</h1>

<p>22.04ではEFIブートイメージ(boot/grub/efi.img)がISOイメージに含まれなくなりました。
詳細と対応策については下記の文書を参照してください。</p>

<ul>
<li><a href="https://askubuntu.com/questions/1403546/ubuntu-22-04-build-iso-both-mbr-and-efi">https://askubuntu.com/questions/1403546/ubuntu-22-04-build-iso-both-mbr-and-efi</a></li>
</ul>

<h1 id="利用手順">利用手順</h1>

<p>ISOイメージをダウンロードと初期ファイルの配置のため、次の作業は1回だけ実行します。</p>

<pre><code>$ make download
$ make init
</code></pre>

<p>以下の作業は、ISOファイルを生成する度に実行する必要があります。</p>

<pre><code>$ make setup
$ make geniso
</code></pre>

<p>新規にファイルを配置した場合には、適宜Makefileを編集してください。</p>

<h2 id="userdataファイル">user-dataファイル</h2>

<p>導入作業のカスタマイズは、config/user-data を中心に行ないます。
主な追加設定の方法についてまとめます。</p>

<h2 id="デフォルトユーザーパスワード">デフォルトユーザー・パスワード</h2>

<p>user-data の username:、 password:行をそれぞれ希望に合わせて変更してください。</p>

<ul>
<li>ID: ubuntu</li>
<li>Password: secret</li>
</ul>

<p>password: 行に指定するハッシュ値は、<code>$ openssl passwd -6 -salt &quot;$(openssl rand -hex 8)&quot; secret</code> コマンドで生成しています。</p>

<h1 id="この他のカスタマイズ">この他のカスタマイズ</h1>

<h2 id="ssh鍵情報の登録">ssh鍵情報の登録</h2>

<p>user-data の authorized-keys の空リストを削除し、.pubファイルの内容を列挙します。</p>

<pre><code>ssh:
  authorized-keys:
    - &quot;ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIH8mvfUPhRddvGXBxGcvwo5m3CRVOf8RbFXwaUa9mhLX comment&quot;
    - &quot;...&quot;
</code></pre>

<h2 id="apuapu2への対応">APU/APU2への対応</h2>

<p>シリアル端末しかないデバイスにOSをインストールするため、次のような変更を加えています。</p>

<ul>
<li>config/isolinux/txt.cfg のappend行の最後に <code>console=ttyS0,115200n8</code> を加える</li>
<li>config/boot/grub/grub.cfg のlinux行の最後に <code>console=ttyS0,115200n8</code> を加える</li>
</ul>

<p>なお、APU/APU2はEFIブートに対応していないため、MBRブートをさせるため、config/user-data.mbr を config/user-data にコピーしてください。</p>

<p>この後に、<code>make setup &amp;&amp; make geniso</code> でISOイメージを作成してください。</p>

<p>以上</p>
